<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html" />
<link rel="import" href="../../bower_components/core-icons/core-icons.html" />
<link rel="import" href="../../bower_components/core-icons/image-icons.html" />

<polymer-element name="octopus-property" attributes="variable">
<template>
<style>

:host {
	background-color: #526E9C;
	color: #FFF;
	border-radius: 2px;
	display: block;
	margin: 5px;
	padding: 5px;
	float: left;
}

#tools core-icon {
	color: #9EB1CF;
	width: 15px;
	height: 15px;
	cursor: pointer;
}

#tools core-icon:hover,
#tools core-icon.active {
	color: #FFF;
}

#value {
	font-size: 1.2em;
	padding: 4px;
}
#value .value {
	font-weight: bold;
}
#value .unit {
	font-size: 0.8em;
}

#editor {
	border-top: 1px solid #9EB1CF;
	margin: 4px;
	padding-top: 6px;
	display: none;
}

#editor.show {
	display: block;
}

</style>

<div id="tools">
	<core-icon icon="cancel" on-click="{{ propertyRemove }}"></core-icon>
	<template if="{{ variable.type === 'int' || variable.type === 'float' }}">
		<core-icon icon="open-in-new" on-click="{{ propertyGraph }}"></core-icon>
	</template>
	<template if="{{ variable.edit }}">
		<core-icon icon="image:edit" on-click="{{ toggleEditor }}"></core-icon>
	</template>
	<span class="name">{{ variable.name }}</span>
</div>

<div id="value">
	<span class="value">{{ variable.value }}</span>
	<span class="unit">{{ variable.unit }}</span>
</div>

<template if="{{ variable.edit }}">
<div id="editor">

<template if="{{ variable.options }}">
	<select on-change="{{ updateValue }}">
		<option template repeat="{{ option in variable.options }}" value="{{ option }}" selected?="{{ variable.value == option }}">
			{{ option }}
		</option>
	</select>
</template>
<template if="{{ !variable.options && variable.type === 'int' || variable.type === 'float' }}">
	<input type="text" on-change="{{ updateValue }}"> {{ variable.unit }}
</template>
<template if="{{ !variable.options && variable.type === 'str' }}">
	<input type="text" on-change="{{ updateValue }}">
</template>

</div>
</template>

</template>
<script>

Polymer('octopus-property', {
	propertyRemove: function (e) {
		this.fire("remove-property");
	},

	propertyGraph: function (e) {
		this.fire("convert-graph");
	},

	toggleEditor: function (e) {
		$(e.srcElement).toggleClass("active");
		$(this.$.editor).toggleClass("show");
		$("input", this.$.editor).val(this.variable.value);
	},
	
	updateValue: function (e) {
		this.fire("set-value", { variable: this.variable.key, value: e.srcElement.value });
	}
});

</script>
</polymer-element>
