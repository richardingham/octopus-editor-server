<html xmlns:t="http://twistedmatrix.com/ns/twisted.web.template/0.1">
<head>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
	<script src="/bower_components/platform/platform.js"></script>
	<link rel="import" href="/bower_components/font-roboto/roboto.html" />

	<link rel="import" href="/components/octopus-editor/octopus-editor.html" />
	<link rel="import" href="/components/octopus-runtime/octopus-runtime.html" />
	<link rel="import" href="/bower_components/core-toolbar/core-toolbar.html" />
	<link rel="import" href="/bower_components/core-icon-button/core-icon-button.html" />
	<link rel="import" href="/bower_components/core-icons/av-icons.html" />

	<link rel="stylesheet" href="/components/octopus-editor/global.css" />
	<link rel="stylesheet" href="/resources/dropdown.css" />

	<style>

	html, body {
		margin: 0;
		padding: 0;
		display: flex;
		height: 100vh;
		flex-direction: column;
	}

	body {
		font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
		color: #333;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
		-webkit-tap-highlight-color: rgba(0,0,0,0);
		-webkit-touch-callout: none;
	}
	
	#editor-container {
		flex: 1;
		display: flex;
		flex-direction: column;
		height: 100vh;
	}

	#editor-toolbar {
		background-color: #526E9C;
		color: #FFF;
		transition: background-color 0.2s linear 0.5s;
	}
	#editor-toolbar.experiment-running {
		background-color: #0D7C38;
	}
	#editor-toolbar.experiment-paused {
		background-color: #FFC200;
	}
	#editor-toolbar.experiment-error {
		background-color: #CB0909;
	}

	#editor-toolbar.experiment-running #btn-run,
	#editor-toolbar.experiment-paused #btn-run,
	#editor-toolbar #btn-pause,
	#editor-toolbar #btn-resume,
	#editor-toolbar #btn-stop {
		display: none;
	}
	#editor-toolbar.experiment-running #btn-pause,
	#editor-toolbar.experiment-paused #btn-resume,
	#editor-toolbar.experiment-running #btn-stop,
	#editor-toolbar.experiment-paused #btn-stop {
		display: block;
	}

	</style>
	
<script>

window.addEventListener('polymer-ready', function () {
	var editor = document.getElementById("editor");
	var runtime = document.getElementById("runtime");
	var toolbar = document.getElementById("editor-toolbar");

	var runButton = document.getElementById("btn-run");
	var stopButton = document.getElementById("btn-stop");
	var pauseButton = document.getElementById("btn-pause");
	var resumeButton = document.getElementById("btn-resume");

	editor.addEventListener("block-event", function (e) {
		runtime.blockEvent.call(runtime, e.detail);
	});

	runtime.addEventListener("sketch-loaded", function (e) {
		editor.loadSketch.call(editor, e.detail);
	});

	//
	// Experiment events
	//
	runtime.addEventListener("experiment-started", function (e) {
		toolbar.className = "experiment-running";
	});
	runtime.addEventListener("experiment-paused", function (e) {
		toolbar.className = "experiment-paused";
	});
	runtime.addEventListener("experiment-resumed", function (e) {
		toolbar.className = "experiment-running";
	});
	runtime.addEventListener("experiment-stopped", function (e) {
		toolbar.className = "";
	});
	runtime.addEventListener("experiment-error", function (e) {
		toolbar.className = "experiment-error";
	});

	//
	// Buttons
	//
	runButton.addEventListener("click", function (e) {
		runtime.experimentAction.call(runtime, "run");
	});
	pauseButton.addEventListener("click", function (e) {
		runtime.experimentAction.call(runtime, "pause");
	});
	resumeButton.addEventListener("click", function (e) {
		runtime.experimentAction.call(runtime, "resume");
	});
	stopButton.addEventListener("click", function (e) {
		runtime.experimentAction.call(runtime, "stop");
	});
});

</script>
  
</head>
<body unresolved="" t:render="editor_body">
	<div id="editor-container">
		<core-toolbar id="editor-toolbar">
			<core-icon-button icon="av:play-circle-fill" id="btn-run">Run</core-icon-button>
			<core-icon-button icon="av:pause-circle-fill" id="btn-pause">Pause</core-icon-button>
			<core-icon-button icon="av:play-circle-fill" id="btn-resume">Resume</core-icon-button>
			<core-icon-button icon="cancel" id="btn-stop">Stop</core-icon-button>
		</core-toolbar>
		<octopus-editor id="editor"></octopus-editor>
	</div>
	<div id="menu-container"></div>
	<octopus-runtime id="runtime" url="ws://127.0.0.1:9000"><t:attr name="sketch"><t:slot name="sketch_id" /></t:attr></octopus-runtime>
</body>
</html>
